<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
    xmlns:drones="clr-namespace:Asv.Drones"
    xmlns:avalonia1="clr-namespace:Asv.Avalonia;assembly=Asv.Avalonia"
    mc:Ignorable="d"
    x:Class="Asv.Drones.MavParamsPageView"
    x:DataType="drones:MavParamsPageViewModel"
>
    <Design.DataContext>
        <drones:MavParamsPageViewModel />
    </Design.DataContext>
    <UserControl.Resources>
        <x:Double x:Key="ButtonSize">30</x:Double>
    </UserControl.Resources>
    <UserControl.Styles>
        <Style Selector="Button">
            <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
        </Style>
        <Style Selector="ToggleButton">
            <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
        </Style>
        <Style Selector="ListBox">
            <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
        </Style>
        <Style Selector="ScrollViewer">
            <Setter Property="CornerRadius" Value="{DynamicResource ControlCornerRadius}" />
        </Style>
    </UserControl.Styles>
    <Panel>
        <avalonia1:AwaitingScreen
            Header="{x:Static drones:RS.MavParamsPageView_AwaitingScreen_Header}"
            Description="{x:Static drones:RS.MavParamsPageView_AwaitingScreen_Description}"
            IsVisible="{Binding !IsDeviceInitialized.Value}"
        />
        <Grid IsVisible="{Binding IsDeviceInitialized.Value}" x:Name="MainGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition MinWidth="220" Width="*" />
                <ColumnDefinition Width="5" />
                <ColumnDefinition MinWidth="500" Width="*" />
            </Grid.ColumnDefinitions>
            <DockPanel Margin="5" Grid.Column="0" LastChildFill="True" x:Name="AllParamsColumn">
                <Grid
                    DockPanel.Dock="Top"
                    Grid.IsSharedSizeScope="True"
                    VerticalAlignment="Stretch"
                    HorizontalAlignment="Stretch"
                    ColumnDefinitions="*, Auto, Auto, Auto"
                    ColumnSpacing="6"
                    Margin="0 0 0 4"
                >
                    <avalonia1:SearchBoxView
                        Grid.Column="0"
                        x:Name="SearchBox"
                        Margin="0"
                        VerticalAlignment="Stretch"
                        DataContext="{Binding Search}"
                    />
                    <Button
                        Grid.Column="1"
                        ToolTip.Tip="{x:Static drones:RS.ParametersEditorPageView_PinsOffButton_ToolTip}"
                        Command="{Binding RemoveAllPins}"
                        Width="{CompiledBinding #SearchBox.Bounds.Height}"
                        Height="{CompiledBinding #SearchBox.Bounds.Height}"
                    >
                        <avalonia:MaterialIcon
                            Kind="PinOff"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                        />
                    </Button>
                    <Button
                        Grid.Column="2"
                        ToolTip.Tip="{x:Static drones:RS.ParametersEditorPageView_UpdateButton_ToolTip}"
                        Command="{Binding UpdateParams}"
                        Width="{CompiledBinding #SearchBox.Bounds.Height}"
                        Height="{CompiledBinding #SearchBox.Bounds.Height}"
                    >
                        <avalonia:MaterialIcon
                            Kind="Sync"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                        />
                    </Button>
                    <ToggleButton
                        Grid.Column="3"
                        ToolTip.Tip="{x:Static drones:RS.ParametersEditorPageView_StarsToggleButton_ToolTip}"
                        IsChecked="{CompiledBinding IsStarredOnly.ViewValue.Value}"
                        Width="{CompiledBinding #SearchBox.Bounds.Height}"
                        Height="{CompiledBinding #SearchBox.Bounds.Height}"
                    >
                        <avalonia:MaterialIcon
                            Kind="Star"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                        />
                    </ToggleButton>
                </Grid>
                <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal">
                    <TextBlock Text="{Binding Total.Value, StringFormat={x:Static drones:RS.ParametersEditorPageViewModel_Total}}" />
                </StackPanel>
                <ScrollViewer MaxHeight="">
                    <ListBox
                        SelectedItem="{Binding SelectedItem.Value}"
                        ItemsSource="{Binding AllParams}"
                    >
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="drones:ParamItemViewModel">
                                <DockPanel
                                    Background="Transparent"
                                    Name="ItemDockPanel"
                                    LastChildFill="True"
                                    DoubleTapped="ItemDockPanel_DoubleTapped"
                                >
                                    <ToggleButton
                                        ToolTip.Tip="{x:Static drones:RS.ParametersEditorPageView_StarButton_ToolTip}"
                                        IsChecked="{Binding IsStarred.ViewValue.Value}"
                                        Margin="10 0 0 0"
                                        BorderThickness="0"
                                        DockPanel.Dock="Right"
                                        Height="{StaticResource ButtonSize}"
                                        Width="{StaticResource ButtonSize}"
                                        IsEnabled="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                                        DoubleTapped="Button_DoubleTapped"
                                    >
                                        <avalonia:MaterialIcon
                                            Classes="medium"
                                            Kind="{Binding StarKind.Value}"
                                        />
                                    </ToggleButton>
                                    <avalonia:MaterialIcon
                                        IsVisible="{Binding IsPinned.ViewValue.Value}"
                                        Classes="medium"
                                        Margin="10 0 0 0"
                                        DockPanel.Dock="Right"
                                        Kind="Pin"
                                    />
                                    <avalonia:MaterialIcon
                                        IsVisible="{Binding !IsSynced.Value}"
                                        Classes="medium"
                                        Margin="10 0 0 0"
                                        DockPanel.Dock="Right"
                                        Kind="FloppyDisk"
                                        avalonia1:AsvPallete.Color="Success"
                                    />
                                    <TextBlock
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Center"
                                        Text="{CompiledBinding Name}"
                                    />
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </DockPanel>
            <GridSplitter
                x:Name="GridSplitterColumn"
                Background="Transparent"
                Grid.Column="1"
                DragCompleted="GridSplitter_Dragged"
            />
            <Panel Grid.Column="2" x:Name="ViewedParamsColumn">
                <StackPanel
                    IsVisible="{Binding IsRefreshing.Value}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                >
                    <TextBlock Text="{x:Static drones:RS.MavParamsPageView_Loading_Text}" />
                    <ProgressBar
                        Width="100"
                        Value="{Binding Progress.Value}"
                        Minimum="0"
                        Maximum="1"
                    />
                    <Button
                        Margin="0,10,0,0"
                        Content="{x:Static drones:RS.MavParamsPageView_CancelButton_Content}"
                        Command="{Binding StopUpdateParams}"
                    ></Button>
                </StackPanel>
                <ScrollViewer ClipToBounds="True" IsVisible="{Binding !IsRefreshing.Value}">
                    <ItemsControl
                        HorizontalAlignment="Stretch"
                        ItemsSource="{Binding ViewedParams}"
                    >
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </ScrollViewer>
            </Panel>
        </Grid>
    </Panel>
</UserControl>
